# DelayedJob monit script generated by capistrano-delayed-job on <%= Time.now %>.
# Based on: https://github.com/collectiveidea/delayed_job/blob/master/contrib/delayed_job_rails_4_multiple.monitrc
#
# The processes are grouped so that monit can act on them as a whole, e.g.
#
#   monit -g delayed_job restart

<% (0..fetch(:delayed_job_workers) - 1).each do |worker_id| %>
check process delayed_job_<%= worker_id %>
  with pidfile <%= shared_path.join('tmp/pids') %>/delayed_job.<%= worker_id %>.pid
  start program = "/bin/su - <%= deploy_user %> -c '<%= delayed_job_command %> start -i <%= worker_id %>'"
  stop program = "/bin/su - <%= deploy_user %> -c '<%= delayed_job_command %> stop -i <%= worker_id %>'"
  group delayed_job
<% end %>
